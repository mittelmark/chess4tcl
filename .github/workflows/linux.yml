name: Release Linux/MacOS
on: 
  workflow_dispatch:
    branches: [ master ]
jobs:
  linux-build:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v4
    - name: Install Tcl
      run: sudo apt install tcl-dev
    - name: Build and test
      run: |
        git clone https://github.com/dbohdan/tcl-duktape.git
        cd tcl-duktape
        ./configure && make test
        ls -l
  macos-build:
    runs-on: macos-13
    steps:
    - name: Checkout
      uses: actions/checkout@v4
    - name: Build and test
      run: |
        brew install tcl-tk@8
        which tclsh
        which tclsh8.6
        find /usr/local -name "tclsh*"
        echo -E "puts $::tcl_patchLevel" | tclsh
        git clone https://github.com/dbohdan/tcl-duktape.git
        cd tcl-duktape
        ./configure --with-tcl /System/Library/Frameworks/Tcl.framework/Versions/Current && make test
        ls -l
        ls /System/Library/Frameworks/Tcl.framework/Versions/Current
        find /System/Library/Frameworks/Tcl.framework/Versions -name "tclConfig.sh"
